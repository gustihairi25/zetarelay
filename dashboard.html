<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZetaChain Pro Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="config.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; }
        .bg-card { background: #0f0f0f; border: 1px solid #1a1a1a; }
        .gold-text { color: #f3ba2f; }
        .glass-nav { background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(15px); border-top: 1px solid #1a1a1a; }
    </style>
</head>
<body class="pb-32">

    <div class="p-6 flex justify-between items-center sticky top-0 z-50 bg-black/80 backdrop-blur-md">
        <div>
            <h1 class="text-xs font-black italic gold-text uppercase tracking-widest">ZetaChain Pro</h1>
            <p id="user-tag" class="text-[8px] text-gray-500 font-bold uppercase tracking-[2px]">Terminal Secured</p>
        </div>
        <button onclick="window.location.href='livechat.html'" class="p-3 bg-yellow-500/10 rounded-2xl text-yellow-500 border border-yellow-500/20">
            <i data-lucide="message-circle" class="w-5 h-5"></i>
        </button>
    </div>

    <div class="px-6 mb-8">
        <div class="bg-card p-8 rounded-[2.5rem] border border-white/5 relative overflow-hidden shadow-2xl text-center">
            <p class="text-[9px] font-black text-gray-500 uppercase tracking-[3px] mb-2 italic">Estimasi Total Aset (IDR)</p>
            <h2 id="total-idr" class="text-4xl font-black italic gold-text tracking-tighter">Rp 0</h2>
            <div class="flex gap-4 mt-8">
                <button onclick="window.location.href='topup.html'" class="flex-1 py-4 bg-yellow-500 text-black rounded-2xl font-black uppercase italic text-[10px]">Deposit</button>
                <button onclick="window.location.href='withdraw.html'" class="flex-1 py-4 bg-white/5 border border-white/10 rounded-2xl font-black uppercase italic text-[10px]">Withdraw</button>
            </div>
        </div>
    </div>

    <div class="px-6 mb-8">
        <h3 class="text-[10px] font-black text-gray-400 uppercase italic tracking-widest mb-4">Dompet Crypto Terintegrasi (10)</h3>
        <div id="wallet-container" class="space-y-3">
            </div>
    </div>

    <div class="px-6 mb-6">
        <div class="bg-card p-5 rounded-[2.5rem] border border-white/5 h-64 overflow-hidden relative">
            <div id="tv_dashboard" class="h-full"></div>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 glass-nav p-5 flex justify-around items-center z-50">
        <button class="text-yellow-500 flex flex-col items-center gap-1">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">Home</span>
        </button>
        <button onclick="window.location.href='future-trade.html'" class="text-gray-500 flex flex-col items-center gap-1">
            <i data-lucide="trending-up" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">Trade</span>
        </button>
        <button onclick="window.location.href='livechat.html'" class="text-gray-500 flex flex-col items-center gap-1">
            <i data-lucide="headphones" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">Support</span>
        </button>
        <button onclick="window.location.href='pin.html'" class="text-gray-500 flex flex-col items-center gap-1">
            <i data-lucide="shield-check" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">PIN</span>
        </button>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const app = initializeApp(APP_CONFIG.firebase);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Nilai tukar estimasi untuk tampilan IDR
        const rates = { BTC: 980000000, ETH: 38000000, SOL: 1450000, TRX: 1800, LINEA: 38000000, ARB: 14000, BNB: 8800000, BASE: 38000000, OP: 24000, MATIC: 7500 };
        const coins = ["BTC", "ETH", "SOL", "TRX", "LINEA", "ARB", "BNB", "BASE", "OP", "MATIC"];

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('user-tag').innerText = "UID: " + user.uid.substring(0,8).toUpperCase();
                const userRef = doc(db, "users", user.uid);
                
                // CEK & AUTO-INIT FIELDS JIKA BELUM ADA
                const snapCheck = await getDoc(userRef);
                if (!snapCheck.exists() || !snapCheck.data().btc_bal) {
                    const initData = { email: user.email, balance: 0 };
                    coins.forEach(c => initData[c.toLowerCase() + "_bal"] = 0);
                    await setDoc(userRef, initData, { merge: true });
                }

                // REAL-TIME LISTENER
                onSnapshot(userRef, (snap) => {
                    if (snap.exists()) renderDashboard(snap.data());
                });
            } else window.location.href = "login.html";
        });

        function renderDashboard(data) {
            const container = document.getElementById('wallet-container');
            container.innerHTML = "";
            let totalVal = 0;

            coins.forEach(coin => {
                const bal = data[coin.toLowerCase() + "_bal"] || 0;
                const idrVal = bal * rates[coin];
                totalVal += idrVal;

                container.innerHTML += `
                    <div class="bg-card p-4 rounded-2xl flex items-center justify-between border border-white/5">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-black rounded-xl flex items-center justify-center border border-yellow-500/20 font-black gold-text italic text-[10px]">${coin.substring(0,3)}</div>
                            <div>
                                <p class="text-[11px] font-black italic uppercase">${coin}</p>
                                <p class="text-[9px] text-gray-500 font-bold tracking-widest">${bal.toFixed(4)} ${coin}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-black italic">Rp ${idrVal.toLocaleString('id-ID')}</p>
                            <p class="text-[7px] text-green-500 font-bold uppercase tracking-widest italic">Live Node</p>
                        </div>
                    </div>`;
            });
            document.getElementById('total-idr').innerText = "Rp " + (totalVal + (data.balance || 0)).toLocaleString('id-ID');
        }

        new TradingView.widget({
            "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "1",
            "theme": "dark", "style": "1", "container_id": "tv_dashboard",
            "hide_top_toolbar": true, "hide_legend": true, "locale": "id"
        });
        lucide.createIcons();
    </script>
</body>
</html>

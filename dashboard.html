<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZetaChain Pro Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="config.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; opacity: 0; transition: opacity 0.5s; height: 100vh; }
        .bg-card { background: #0f0f0f; border: 1px solid #1a1a1a; }
        .main-content { height: calc(100vh - 75px); overflow-y: auto; padding-bottom: 40px; }
        .gold-text { color: #f3ba2f; }
        .gold-bg { background: #f3ba2f; color: #000; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 75px; background: #0a0a0a; border-top: 1px solid #1a1a1a; display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #444; font-size: 9px; font-weight: 800; text-transform: uppercase; }
        .nav-item.active { color: #f3ba2f; }
        
        #chartContainer { width: 100%; height: 230px; position: relative; background: radial-gradient(circle at center, #111 0%, #000 100%); margin: 10px 0; overflow: hidden; }
        #live-tag { transition: top 0.1s linear; border-radius: 4px 0 0 4px; padding: 2px 8px; z-index: 20; white-space: nowrap; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="p-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 gold-bg rounded-xl flex items-center justify-center text-xl">
                    <i class="fa-solid fa-user-shield"></i>
                </div>
                <div>
                    <p id="u-status-kyc" class="text-[7px] text-gray-500 font-bold uppercase tracking-widest italic">Professional Account</p>
                    <h2 id="u-email" class="text-xs font-black italic gold-text uppercase underline decoration-yellow-500/30">Loading...</h2>
                </div>
            </div>
            <button onclick="location.href='setting-akun.html'" class="text-gray-500 active:scale-90 transition-transform"><i class="fa-solid fa-gear text-lg"></i></button>
        </div>

        <div class="px-6">
            <div class="bg-card p-5 rounded-[2rem] border-l-4 border-yellow-500 mb-4 shadow-xl shadow-yellow-500/5">
                <p class="text-[8px] text-gray-500 font-black uppercase tracking-[3px] mb-1">Total Equity (Multi-Chain)</p>
                <div class="flex items-baseline gap-2">
                    <h3 id="u-total-equity" class="text-3xl font-black italic tracking-tighter text-white">0.00</h3>
                    <span class="text-[10px] gold-text font-black">USD</span>
                </div>
            </div>
            
            <div id="mini-wallets" class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                </div>
        </div>

        <div class="px-6 mt-6">
            <div class="bg-card p-6 rounded-[2rem] border border-white/5 text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 p-3 opacity-10"><i class="fa-solid fa-qrcode text-4xl"></i></div>
                <p class="text-[9px] text-yellow-500 font-black uppercase tracking-widest mb-4">Topup Jaringan: <span id="coin-label" class="underline">BTC</span></p>
                
                <div id="qrcode" class="bg-white p-3 rounded-2xl inline-block shadow-2xl shadow-yellow-500/20"></div>
                
                <div class="mt-4 p-3 bg-black/60 rounded-xl border border-white/5 group active:bg-yellow-500/10 transition-colors cursor-pointer" onclick="copyDepositAddr()">
                    <p id="deposit-address" class="text-[9px] font-mono break-all text-gray-400 uppercase tracking-tighter leading-tight"></p>
                    <p class="mt-2 text-[7px] font-black gold-text uppercase italic"><i class="fa-solid fa-copy mr-1"></i> Tap untuk Salin Alamat</p>
                </div>

                <button onclick="confirmTransfer()" class="w-full mt-4 py-4 gold-bg rounded-2xl font-black italic uppercase text-[10px] shadow-lg active:scale-95 transition-all">
                    Konfirmasi Deposit Selesai
                </button>
            </div>
        </div>

        <div class="px-6 mt-8">
            <p class="text-[8px] text-gray-500 font-black uppercase mb-3 tracking-[3px]">Bursa Live</p>
            <div id="coin-list" class="flex gap-2 overflow-x-auto no-scrollbar pb-2"></div>
        </div>

        <div id="chartContainer">
            <div class="absolute top-2 left-6 z-10">
                <h4 id="active-coin-name" class="text-lg font-black italic gold-text tracking-tighter">BTC/USDT</h4>
            </div>
            <canvas id="mainChart"></canvas>
            <div id="live-tag" class="absolute right-0 bg-green-500 text-black font-black italic text-[9px]">0.00</div>
        </div>

        <div class="px-6 grid grid-cols-4 gap-3 mt-4 mb-20">
            </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active"><i class="fa-solid fa-house-chimney text-xl"></i><span>Beranda</span></div>
        <div onclick="location.href='bursa-pasar.html'" class="nav-item"><i class="fa-solid fa-chart-line text-xl"></i><span>Pasar</span></div>
        <div onclick="location.href='future-trade.html'" class="nav-item"><i class="fa-solid fa-shuffle text-xl"></i><span>Trade</span></div>
        <div onclick="location.href='profil.html'" class="nav-item"><i class="fa-solid fa-user-circle text-xl"></i><span>Profil</span></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const app = initializeApp(APP_CONFIG.firebase);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // 10 Mata Uang Crypto Utama
        const mainCoins = ["BTC", "ETH", "SOL", "TRX", "BNB", "MATIC", "ARB", "BASE", "OP", "LINEA"];
        let currentCoin = localStorage.getItem('selectedCoin') || "BTC";

        // Generate Mini Wallet UI
        const miniContainer = document.getElementById('mini-wallets');
        mainCoins.forEach(coin => {
            miniContainer.innerHTML += `
                <div class="bg-card p-3 rounded-2xl min-w-[100px] border border-white/5">
                    <p class="text-[7px] text-gray-500 font-bold">${coin} WALLET</p>
                    <p id="bal-${coin}" class="text-[11px] font-black italic gold-text">0.00</p>
                </div>
            `;
        });

        // Market List Buttons
        const coinList = document.getElementById('coin-list');
        mainCoins.forEach(c => {
            const btn = document.createElement('button');
            btn.className = `px-4 py-2 rounded-xl border border-white/10 text-[10px] font-black italic uppercase ${c === currentCoin ? 'gold-bg text-black' : 'bg-card text-gray-500'}`;
            btn.innerText = c;
            btn.onclick = () => { localStorage.setItem('selectedCoin', c); location.reload(); };
            coinList.appendChild(btn);
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.body.style.opacity = "1";
                onSnapshot(doc(db, "users", user.uid), (snap) => {
                    const d = snap.data();
                    if(d) {
                        document.getElementById('u-email').innerText = d.email.split('@')[0];
                        document.getElementById('u-total-equity').innerText = (d.balance_usd || 0).toFixed(2);
                        
                        // Update individual balances
                        mainCoins.forEach(coin => {
                            const val = d[`bal_${coin.toLowerCase()}`] || 0;
                            document.getElementById(`bal-${coin}`).innerText = val.toFixed(coin === "BTC" ? 6 : 2);
                        });
                    }
                });
            } else { location.href = "login.html"; }
        });

        // --- DYNAMIC DEPOSIT SYSTEM ---
        function initDeposit() {
            const addr = APP_CONFIG.depositAddresses[currentCoin] || APP_CONFIG.depositAddresses["ETH"];
            document.getElementById('coin-label').innerText = currentCoin;
            document.getElementById('deposit-address').innerText = addr;

            const qrContainer = document.getElementById("qrcode");
            qrContainer.innerHTML = "";
            new QRCode(qrContainer, {
                text: addr,
                width: 120,
                height: 120,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        window.copyDepositAddr = () => {
            const addr = document.getElementById('deposit-address').innerText;
            navigator.clipboard.writeText(addr);
            alert("Alamat " + currentCoin + " Berhasil Disalin!");
        };

        window.confirmTransfer = async () => {
            const amt = prompt("Masukkan jumlah koin yang Anda kirim:");
            if(!amt || isNaN(amt)) return;
            const user = auth.currentUser;
            await addDoc(collection(db, "users", user.uid, "transactions"), {
                title: `Deposit ${currentCoin}`,
                amount: parseFloat(amt),
                type: 'deposit',
                status: 'pending',
                timestamp: new Date()
            });
            alert("Laporan deposit dikirim! Saldo akan masuk setelah divalidasi admin.");
        };

        initDeposit();

        // --- ENJIN GRAFIK (BTC/ETH/ETC) ---
        // (Gunakan kode grafik dari dashboard.html sebelumnya di sini)
        // Ganti bagian "Rp" menjadi "$" pada label harga
        
        const canvas = document.getElementById('mainChart');
        const ctx = canvas.getContext('2d');
        const tag = document.getElementById('live-tag');
        let prices = Array.from({length: 60}, () => 50000 + (Math.random()-0.5)*1000);

        function draw() {
            canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
            const min = Math.min(...prices) * 0.999;
            const max = Math.max(...prices) * 1.001;
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.beginPath();
            ctx.strokeStyle = "#f3ba2f";
            ctx.lineWidth = 2;
            prices.forEach((p, i) => {
                const x = i * (canvas.width / 59);
                const y = canvas.height - ((p - min) / (max - min) * canvas.height);
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                if(i===59) {
                    tag.style.top = (y-10)+"px";
                    tag.innerText = p.toFixed(2);
                }
            });
            ctx.stroke();
        }
        setInterval(() => {
            prices.push(prices[prices.length-1] + (Math.random()-0.5)*10);
            prices.shift();
            draw();
        }, 1000);
        
        lucide.createIcons();
    </script>
</body>
</html>

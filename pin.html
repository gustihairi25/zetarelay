<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keamanan | ZetaChain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { background: #050505; color: white; font-family: sans-serif; }
        .pin-box { background: #111; border: 1px solid #222; color: #f3ba2f; text-align: center; font-size: 2rem; border-radius: 20px; padding: 15px; width: 100%; letter-spacing: 0.3em; outline: none; }
        .gold-btn { background: linear-gradient(135deg, #f3ba2f 0%, #ffdb4d 100%); color: black; font-weight: 800; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6">
    <div class="w-full max-w-xs text-center">
        <h2 id="title" class="text-xl font-black uppercase mb-2 italic">Keamanan <span class="text-[#f3ba2f]">PRO</span></h2>
        <p id="desc" class="text-gray-500 text-[10px] uppercase mb-8">Verifikasi Identitas Terminal</p>
        
        <input type="password" id="pinInput" maxlength="6" inputmode="numeric" placeholder="••••••" class="pin-box mb-6">
        <button onclick="proses()" id="btn-p" class="w-full py-4 gold-btn rounded-2xl uppercase italic transition-all">Konfirmasi</button>
    </div>

    <script>
        var config = {
            apiKey: "AIzaSyDrpBJTtankyLgimtOwuriFpiyuC5K10OI",
            authDomain: "studio-727777898-40aea.firebaseapp.com",
            projectId: "studio-727777898-40aea",
            appId: "1:351263967108:web:a0c01af41422903cc17fd1"
        };
        firebase.initializeApp(config);
        var auth = firebase.auth();
        var db = firebase.firestore();
        var uid = "";
        var pinDB = "";

        auth.onAuthStateChanged(function(user) {
            if (!user) { window.location.href = "login.html"; } 
            else {
                uid = user.uid;
                db.collection("users").doc(uid).get().then(function(doc) {
                    if (doc.exists) {
                        pinDB = doc.data().pin || "";
                        document.getElementById('desc').innerText = pinDB === "" ? "Daftarkan PIN Baru Anda" : "Masukkan PIN Akses Anda";
                    }
                });
            }
        });

        function proses() {
            var val = document.getElementById('pinInput').value;
            if(val.length < 6) { alert("PIN harus 6 angka!"); return; }

            if(pinDB === "") {
                db.collection("users").doc(uid).update({ pin: val }).then(function() {
                    window.location.href = "dashboard.html";
                });
            } else {
                if(val === pinDB) {
                    window.location.href = "dashboard.html";
                } else {
                    alert("PIN SALAH!");
                    document.getElementById('pinInput').value = "";
                }
            }
        }
    </script>
</body>
</html>

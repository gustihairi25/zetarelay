<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Saya | CryptoPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #000; color: #fff; }
        .card-glass { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #8A6E20 100%); }
    </style>
</head>
<body class="p-6 pb-32">

    <div class="flex items-center gap-4 mb-10">
        <button onclick="window.location.href='dashboard.html'" class="p-2 bg-white/5 rounded-full">
            <i data-lucide="arrow-left"></i>
        </button>
        <h2 class="text-xl font-black italic uppercase">Profil <span class="text-yellow-500">Akun</span></h2>
    </div>

    <div class="flex flex-col items-center text-center space-y-6 mb-10">
        <div id="user-avatar" class="w-24 h-24 gold-gradient rounded-[2.5rem] flex items-center justify-center text-black text-4xl font-black shadow-2xl shadow-yellow-500/20 uppercase">
            ?
        </div>
        <div>
            <h1 id="user-display-name" class="text-xl font-black uppercase italic tracking-tighter">Memuat...</h1>
            <p id="user-email" class="text-[10px] text-gray-500 mt-1 font-bold">...</p>
            <div id="kyc-badge" class="mt-3">
                <span class="text-[8px] bg-white/5 text-gray-500 px-3 py-1 rounded-full font-black uppercase tracking-widest border border-white/10">Mengecek Status...</span>
            </div>
        </div>
    </div>

    <div class="card-glass p-6 rounded-[2rem] space-y-4">
        <div class="flex items-center justify-between">
            <span class="text-[10px] font-black text-gray-400 uppercase tracking-widest">ID Transaksi Unik (UID)</span>
            <i data-lucide="shield-check" class="text-yellow-500 w-4 h-4"></i>
        </div>
        <div class="flex gap-2">
            <input type="text" id="uid-display" readonly
                   class="flex-1 bg-white/5 border border-white/10 p-4 rounded-xl text-[10px] font-mono text-yellow-500 outline-none"
                   value="Loading UID...">
            <button onclick="copyUID()" class="bg-yellow-500 text-black px-4 rounded-xl active:scale-90 transition-transform">
                <i data-lucide="copy" class="w-5 h-5"></i>
            </button>
        </div>
        <p class="text-[9px] text-gray-500 leading-relaxed italic">
            *Gunakan ID ini untuk menerima transfer saldo antar sesama pengguna CryptoPro secara instan.
        </p>
    </div>

    <div class="grid grid-cols-2 gap-4 mt-6">
        <div class="card-glass p-5 rounded-[2rem]">
            <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Keamanan</p>
            <p class="text-sm font-black text-green-500">LEVEL 3 (HIGH)</p>
        </div>
        <div class="card-glass p-5 rounded-[2rem]">
            <p class="text-[10px] text-gray-500 uppercase font-bold mb-1">Negara</p>
            <p class="text-sm font-black uppercase">Indonesia</p>
        </div>
    </div>

    <button id="btn-logout" class="w-full mt-12 py-5 border border-red-500/30 text-red-500 font-black rounded-2xl uppercase tracking-widest text-[10px] active:bg-red-500/10 transition-all">
        Logout dari Sistem
    </button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDrpBJTtankyLgimtOwuriFpiyuC5K10OI",
            authDomain: "studio-727777898-40aea.firebaseapp.com",
            projectId: "studio-727777898-40aea",
            storageBucket: "studio-727777898-40aea.firebasestorage.app",
            messagingSenderId: "351263967108",
            appId: "1:351263967108:web:973eb49037d874e5c17fd1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('user-email').innerText = user.email;
                document.getElementById('uid-display').value = user.uid;
                document.getElementById('user-avatar').innerText = user.email[0].toUpperCase();

                const userRef = doc(db, "users", user.uid);
                onSnapshot(userRef, (snap) => {
                    if (snap.exists()) {
                        const data = snap.data();

                        document.getElementById('user-display-name').innerText = (data.name || user.email.split('@')[0]).toUpperCase();

                        // PERBAIKAN LOGIKA STATUS KYC
                        const badgeContainer = document.getElementById('kyc-badge');
                        // Mengecek 'success' (dari Admin) atau 'verified' (standar lama)
                        if (data.kycStatus === 'success' || data.kyc === 'verified') {
                            badgeContainer.innerHTML = `<span class="text-[8px] bg-green-500 text-black px-3 py-1 rounded-full font-black uppercase tracking-widest border border-green-500 shadow-lg shadow-green-500/20">Verified Account</span>`;
                        } else if (data.kycStatus === 'pending' || data.kyc === 'pending') {
                            badgeContainer.innerHTML = `<span class="text-[8px] bg-yellow-500/10 text-yellow-500 px-3 py-1 rounded-full font-black uppercase tracking-widest border border-yellow-500/20">Pending Review</span>`;
                        } else {
                            badgeContainer.innerHTML = `<span class="text-[8px] bg-red-500/10 text-red-500 px-3 py-1 rounded-full font-black uppercase tracking-widest border border-red-500/20">Unverified Account</span>`;
                        }
                    }
                });

            } else {
                window.location.href = 'login.html';
            }
        });

        window.copyUID = () => {
            const uidText = document.getElementById('uid-display').value;
            navigator.clipboard.writeText(uidText).then(() => {
                // Menggunakan UI sederhana pengganti alert jika diinginkan, 
                // tapi tetap alert agar sesuai kode asli Anda.
                alert("UID Berhasil Disalin!");
            });
        };

        document.getElementById('btn-logout').onclick = async () => {
            if(confirm("Apakah Anda yakin ingin keluar?")) {
                await signOut(auth);
                window.location.href = 'login.html';
            }
        };

        lucide.createIcons();
    </script>
</body>
</html>

